(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function s(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=s(a);fetch(a.href,l)}})();const D={a3:{name:"A3 Landscape",width:420,height:297},a4:{name:"A4 Portrait",width:210,height:297},a4_land:{name:"A4 Landscape",width:297,height:210},axidraw_v3:{name:"AxiDraw V3",width:279,height:216}},I={flowfield:{noiseScale:.01,density:1e3,stepLen:5,maxSteps:50,force:1,chaos:0,octaves:1},lissajous:{freqX:3,freqY:2,damping:.001,phase:1.5,rotation:0,resolution:100},wavetable:{lines:40,amplitude:30,zoom:.02,tilt:0,gap:1,freq:1},spiral:{loops:10,res:100,noiseAmp:10,noiseFreq:.1,startR:5},grid:{rows:20,cols:20,distortion:10,noiseScale:.05,type:"warp",chaos:0},phylla:{count:500,spacing:5,angleStr:137.5,divergence:1,noiseInf:0},boids:{count:100,steps:100,speed:2,sepDist:10,alignDist:20,cohDist:20,force:.05},attractor:{type:"lorenz",iter:1e3,scale:3,sigma:10,rho:28,beta:2.66,dt:.01},hyphae:{sources:2,steps:50,branchProb:.05,angleVar:.5,segLen:3},circles:{count:500,minR:2,maxR:20,padding:1,attempts:200},cityscape:{rows:3,minW:10,maxW:40,minH:10,maxH:80,windowProb:.3,detail:.5}},M={margin:20,speedDown:250,speedUp:300,precision:3,strokeWidth:.3,bgColor:"#121214",globalLayerCount:0},k={flowfield:{generate:(e,t,s,n)=>{const{m:a,dW:l,dH:d,width:h,height:y}=n,p=[];for(let o=0;o<e.density;o++){const i=[];let c=a+t.nextFloat()*l,m=a+t.nextFloat()*d;i.push({x:c,y:m});for(let r=0;r<e.maxSteps;r++){let g=s.noise2D(c*e.noiseScale,m*e.noiseScale);e.octaves>1&&(g+=.5*s.noise2D(c*e.noiseScale*2,m*e.noiseScale*2));const u=g*Math.PI*2*e.force+t.nextFloat()*e.chaos;if(c+=Math.cos(u)*e.stepLen,m+=Math.sin(u)*e.stepLen,c<a||c>h-a||m<a||m>y-a)break;i.push({x:c,y:m})}i.length>1&&p.push(i)}return p},formula:e=>`θ = noise(x * ${e.noiseScale}, y * ${e.noiseScale}) * 2π * ${e.force}
pos += [cos(θ), sin(θ)] * ${e.stepLen}`},boids:{generate:(e,t,s,n)=>{const{m:a,dW:l,dH:d,width:h,height:y}=n,p=[];for(let o=0;o<e.count;o++)p.push({x:a+t.nextFloat()*l,y:a+t.nextFloat()*d,vx:(t.nextFloat()-.5)*e.speed,vy:(t.nextFloat()-.5)*e.speed,path:[]});for(let o=0;o<e.steps;o++)p.forEach(i=>{i.path.push({x:i.x,y:i.y});let c=0,m=0,r=0,g=0,u=0,x=0,v=0;p.forEach(w=>{if(i===w)return;const S=i.x-w.x,L=i.y-w.y,P=Math.sqrt(S*S+L*L);P<e.sepDist&&(c+=S/P,m+=L/P),P<e.alignDist&&(r+=w.vx,g+=w.vy),P<e.cohDist&&(u+=w.x,x+=w.y,v++)}),v>0&&(u=(u/v-i.x)*.01,x=(x/v-i.y)*.01,r=(r/v-i.vx)*.05,g=(g/v-i.vy)*.05),i.vx+=c*e.force+r+u,i.vy+=m*e.force+g+x;const b=Math.sqrt(i.vx*i.vx+i.vy*i.vy);b>e.speed&&(i.vx=i.vx/b*e.speed,i.vy=i.vy/b*e.speed),i.x+=i.vx,i.y+=i.vy,i.x<a&&(i.vx*=-1),i.x>h-a&&(i.vx*=-1),i.y<a&&(i.vy*=-1),i.y>y-a&&(i.vy*=-1)});return p.map(o=>o.path)},formula:e=>`v += separate * ${e.sepDist} + align * ${e.alignDist} + cohere * ${e.cohDist}
pos += v * ${e.speed}`},attractor:{generate:(e,t,s,n)=>{const{width:a,height:l}=n,d=e.dt;let h=.1,y=0,p=0;const o=[],i=a/2,c=l/2;for(let m=0;m<e.iter;m++){let r,g,u;e.type==="lorenz"?(r=e.sigma*(y-h),g=h*(e.rho-p)-y,u=h*y-e.beta*p):(r=(p-.7)*h-3.5*y,g=3.5*h+(p-.7)*y,u=.6+.95*p-p*p*p/3-(h*h+y*y)*(1+.25*p)+.1*p*(h*h*h)),h+=r*d,y+=g*d,p+=u*d,o.push({x:i+h*e.scale,y:c+y*e.scale})}return[o]},formula:e=>`dx = ${e.sigma}(y - x)
dy = x(${e.rho} - z) - y
dz = xy - ${e.beta}z`},hyphae:{generate:(e,t,s,n)=>{const{m:a,dW:l,dH:d,width:h,height:y}=n,p=[],o=[],i=1e3;for(let c=0;c<e.sources;c++)p.push({x:a+t.nextFloat()*l,y:a+t.nextFloat()*d,angle:t.nextFloat()*Math.PI*2,path:[]});for(let c=0;c<e.steps&&!(p.length>=i);c++)for(let m=p.length-1;m>=0;m--){const r=p[m];r.path.push({x:r.x,y:r.y}),r.x+=Math.cos(r.angle)*e.segLen,r.y+=Math.sin(r.angle)*e.segLen,r.angle+=(t.nextFloat()-.5)*e.angleVar,t.nextFloat()<e.branchProb&&p.length<i&&p.push({x:r.x,y:r.y,angle:r.angle+Math.PI/2,path:[]}),(r.x<a||r.x>h-a||r.y<a||r.y>y-a)&&(p.splice(m,1),o.push(r.path))}return p.forEach(c=>o.push(c.path)),o},formula:e=>`pos += [cos(α), sin(α)] * ${e.segLen}
if rand() < ${e.branchProb}: branch(α + π/2)`},cityscape:{generate:(e,t,s,n)=>{const{m:a,width:l,height:d}=n,h=[],y=d*.7;for(let p=0;p<e.rows;p++){const o=y+p*15;let i=a;for(;i<l-a;){const c=t.nextRange(e.minW,e.maxW),m=s.noise2D(i*.01,p*10),r=t.nextRange(e.minH,e.maxH),g=Math.abs(r*(1+m*.5)),u=[{x:i,y:o},{x:i,y:o-g},{x:i+c,y:o-g},{x:i+c,y:o},{x:i,y:o}];if(h.push(u),t.nextFloat()<e.detail){const x=i+c/2,v=o-g,b=t.nextRange(2,10);h.push([{x,y:v},{x,y:v-b}])}if(t.nextFloat()<e.windowProb)for(let b=i+3;b<i+c-3;b+=3)for(let w=o-g+3;w<o-3;w+=4)t.nextFloat()>.4||h.push([{x:b,y:w},{x:b,y:w+2}]);i+=c}}return h},formula:e=>`for row in 0..${e.rows}:
  h = rand(${e.minH}, ${e.maxH}) * noise(x)
  rect(x, yBase, w, h)`},circles:{generate:(e,t,s,n)=>{const{m:a,dW:l,dH:d}=n,h=[],y=[];for(let p=0;p<e.attempts&&!(h.length>=e.count);p++){const o=t.nextRange(e.minR,e.maxR),i=a+o+t.nextFloat()*(l-o*2),c=a+o+t.nextFloat()*(d-o*2);let m=!0;for(let r of h)if(Math.sqrt((i-r.x)**2+(c-r.y)**2)<r.r+o+e.padding){m=!1;break}if(m){h.push({x:i,y:c,r:o});const r=[];for(let g=0;g<=32;g++){const u=g/32*Math.PI*2;r.push({x:i+Math.cos(u)*o,y:c+Math.sin(u)*o})}y.push(r)}}return y},formula:e=>`if dist(p, others) > r + ${e.padding}: add(circle(p, r))
r = rand(${e.minR}, ${e.maxR})`},lissajous:{generate:(e,t,s,n)=>{const{width:a,height:l}=n,d=a/2,h=l/2,y=Math.min(a,l)*.4,p=[];for(let o=0;o<200;o+=.05){const i=Math.exp(-e.damping*o);if(i<.01)break;let c=Math.sin(e.freqX*o+e.phase),m=Math.sin(e.freqY*o);if(e.rotation!==0){const r=e.rotation*(Math.PI/180),g=c*Math.cos(r)-m*Math.sin(r),u=c*Math.sin(r)+m*Math.cos(r);c=g,m=u}p.push({x:d+c*y*i,y:h+m*y*i})}return[p]},formula:e=>`x = sin(${e.freqX}t + ${e.phase})
y = sin(${e.freqY}t)
amp = e^(-${e.damping}t)`},wavetable:{generate:(e,t,s,n)=>{const{m:a,dW:l,dH:d,height:h}=n,y=[],p=d/e.lines,o=Math.floor(l/2),i=l/o;for(let c=0;c<e.lines;c++){const m=[],r=a+c*p*e.gap+e.tilt*c;for(let g=0;g<=o;g++){const u=a+g*i,x=s.noise2D(u*e.zoom*e.freq,r*e.zoom),v=Math.abs(x)*e.amplitude;let b=1;const w=Math.abs(g/o-.5)*2;w>.8&&(b=1-(w-.8)/.2);const S=r-v*b;S>a&&S<h-a&&m.push({x:u,y:S})}m.length>1&&y.push(m)}return y},formula:()=>"y = yBase - (|noise(x,y)| * amplitude)"},spiral:{generate:(e,t,s,n)=>{const{dW:a,dH:l,width:d,height:h}=n,y=d/2,p=h/2,o=[];let i=e.startR,c=0;const m=Math.min(a,l)/2,r=(m-e.startR)/(e.loops*e.res),g=Math.PI*2/e.res;for(;i<m;){const u=s.noise2D(Math.cos(c)*e.noiseFreq,Math.sin(c)*e.noiseFreq),x=i+u*e.noiseAmp;o.push({x:y+Math.cos(c)*x,y:p+Math.sin(c)*x}),c+=g,i+=r}return[o]},formula:()=>`r = r + (noise(θ) * amp)
x = cos(θ)*r, y = sin(θ)*r`},grid:{generate:(e,t,s,n)=>{const{m:a,dW:l,dH:d}=n,h=[],y=l/e.cols,p=d/e.rows;for(let o=0;o<=e.rows;o++){const i=[];for(let c=0;c<=e.cols;c++){let m=a+c*y,r=a+o*p;const g=s.noise2D(m*e.noiseScale,r*e.noiseScale);e.type==="warp"?(m+=Math.cos(g*Math.PI)*e.distortion,r+=Math.sin(g*Math.PI)*e.distortion):r+=g*e.distortion,m+=(t.nextFloat()-.5)*e.chaos,r+=(t.nextFloat()-.5)*e.chaos,i.push({x:m,y:r})}h.push(i)}for(let o=0;o<=e.cols;o++){const i=[];for(let c=0;c<=e.rows;c++){let m=a+o*y,r=a+c*p;const g=s.noise2D(m*e.noiseScale,r*e.noiseScale);e.type==="warp"?(m+=Math.cos(g*Math.PI)*e.distortion,r+=Math.sin(g*Math.PI)*e.distortion):r+=g*e.distortion,m+=(t.nextFloat()-.5)*e.chaos,r+=(t.nextFloat()-.5)*e.chaos,i.push({x:m,y:r})}h.push(i)}return h},formula:()=>"pos += noise(x,y) * distortion"},phylla:{generate:(e,t,s,n)=>{const{m:a,width:l,height:d}=n,h=[],y=l/2,p=d/2,o=e.angleStr*(Math.PI/180);for(let i=0;i<e.count;i++){const c=e.spacing*Math.sqrt(i)*e.divergence,m=i*o;let r=y+c*Math.cos(m),g=p+c*Math.sin(m);const u=s.noise2D(r*.05,g*.05);r+=u*e.noiseInf,g+=u*e.noiseInf;const x=[];for(let v=0;v<=8;v++){const b=v/8*Math.PI*2;x.push({x:r+Math.cos(b)*1,y:g+Math.sin(b)*1})}r>a&&r<l-a&&g>a&&g<d-a&&h.push(x)}return h},formula:()=>`θ = i * 137.5°, r = c√i
pos = [cos(θ)*r, sin(θ)*r]`}};class A{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||Math.floor(Math.random()*(this.m-1))}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,s){return t+this.nextFloat()*(s-t)}}class T{constructor(t){this.rng=new A(t),this.perm=new Uint8Array(512),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.seed(t)}seed(t){this.rng=new A(t);const s=new Uint8Array(256).map((n,a)=>a);for(let n=255;n>0;n--){const a=Math.floor(this.rng.nextFloat()*(n+1));[s[n],s[a]]=[s[a],s[n]]}for(let n=0;n<512;n++)this.perm[n]=s[n&255]}dot(t,s,n){return t[0]*s+t[1]*n}noise2D(t,s){const n=.5*(Math.sqrt(3)-1),a=(3-Math.sqrt(3))/6;let l=(t+s)*n,d=Math.floor(t+l),h=Math.floor(s+l),y=(d+h)*a,p=d-y,o=h-y,i=t-p,c=s-o,m=i>c?1:0,r=i>c?0:1,g=i-m+a,u=c-r+a,x=i-1+2*a,v=c-1+2*a,b=d&255,w=h&255,S=this.perm[b+this.perm[w]]%12,L=this.perm[b+m+this.perm[w+r]]%12,P=this.perm[b+1+this.perm[w+1]]%12,C=0,E=0,q=0,F=.5-i*i-c*c,R=.5-g*g-u*u,$=.5-x*x-v*v;return F>=0&&(F*=F,C=F*F*this.dot(this.grad3[S],i,c)),R>=0&&(R*=R,E=R*R*this.dot(this.grad3[L],g,u)),$>=0&&($*=$,q=$*$*this.dot(this.grad3[P],x,v)),70*(C+E+q)}}class H{constructor(t,s="flowfield",n){this.id=t,this.type=s,this.name=n,this.params=JSON.parse(JSON.stringify(I[s]||I.flowfield)),this.params.seed=Math.floor(Math.random()*99999),this.params.posX=0,this.params.posY=0,this.params.scaleX=1,this.params.scaleY=1,this.color="#e4e4e7",this.visible=!0,this.paths=[]}}class W{constructor(){this.layers=[],this.activeLayerId=null,this.currentProfile=D.a3,this.addLayer("flowfield")}addLayer(t="flowfield"){const s=Math.random().toString(36).substr(2,9);M.globalLayerCount++;const n=String(M.globalLayerCount).padStart(2,"0"),l=`${t.charAt(0).toUpperCase()+t.slice(1)} ${n}`,d=new H(s,t,l);return this.layers.push(d),this.activeLayerId=s,this.generate(s),s}removeLayer(t){this.layers.length<=1||(this.layers=this.layers.filter(s=>s.id!==t),this.activeLayerId===t&&(this.activeLayerId=this.layers[this.layers.length-1].id))}moveLayer(t,s){const n=this.layers.findIndex(l=>l.id===t);if(n===-1)return;const a=n+s;a>=0&&a<this.layers.length&&([this.layers[n],this.layers[a]]=[this.layers[a],this.layers[n]])}getActiveLayer(){return this.layers.find(t=>t.id===this.activeLayerId)}setProfile(t){this.currentProfile=D[t]||D.a3}generate(t){const s=this.layers.find(g=>g.id===t);if(!s)return;const n=new A(s.params.seed),a=new T(s.params.seed),{width:l,height:d}=this.currentProfile,h=M.margin,y=l-h*2,p=d-h*2,o=s.params,i={width:l,height:d,m:h,dW:y,dH:p},c=g=>{const u=l/2,x=d/2;let v=g.x-u,b=g.y-x;return v*=o.scaleX,b*=o.scaleY,v+=u+o.posX,b+=x+o.posY,{x:v,y:b}},r=(k[s.type]||k.flowfield).generate(o,n,a,i);s.paths=r.map(g=>g.map(u=>c(u)))}getFormula(t){const s=this.layers.find(a=>a.id===t);if(!s)return"Select a layer...";const n=k[s.type];return n&&n.formula?n.formula(s.params):"Procedural Vector Generation"}getStats(){let t=0;this.layers.forEach(l=>{l.visible&&l.paths.forEach(d=>{for(let h=1;h<d.length;h++){const y=d[h].x-d[h-1].x,p=d[h].y-d[h-1].y;t+=Math.sqrt(y*y+p*p)}})});const s=t/1e3/(M.speedDown/1e3),n=Math.floor(s/60),a=Math.floor(s%60);return{distance:Math.round(t/1e3)+"m",time:`${n}:${a.toString().padStart(2,"0")}`}}}class X{constructor(t,s){if(this.canvas=document.getElementById(t),this.ctx=this.canvas?this.canvas.getContext("2d"):null,this.engine=s,this.scale=1,this.offsetX=0,this.offsetY=0,this.isDrag=!1,this.lastM={x:0,y:0},this.ready=!!(this.canvas&&this.ctx),!this.ready){console.warn(`[Renderer] Missing canvas or context for #${t}`);return}const n=this.canvas.parentElement;if(!n){console.warn("[Renderer] Canvas has no parent element."),this.ready=!1;return}new ResizeObserver(()=>this.resize()).observe(n),this.canvas.addEventListener("wheel",a=>this.wheel(a)),this.canvas.addEventListener("mousedown",a=>this.down(a)),window.addEventListener("mousemove",a=>this.move(a)),window.addEventListener("mouseup",()=>this.up())}resize(){if(!this.ready||!this.canvas||!this.ctx)return;const t=this.canvas.parentElement.getBoundingClientRect();this.canvas.width=t.width*window.devicePixelRatio,this.canvas.height=t.height*window.devicePixelRatio,this.canvas.style.width=`${t.width}px`,this.canvas.style.height=`${t.height}px`,this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),this.scale===1&&this.center(),this.draw()}center(){if(!this.ready||!this.canvas)return;const t=this.engine.currentProfile,s=this.canvas.getBoundingClientRect(),n=(s.width-60)/t.width,a=(s.height-60)/t.height;this.scale=Math.min(n,a),this.offsetX=(s.width-t.width*this.scale)/2,this.offsetY=(s.height-t.height*this.scale)/2}draw(){if(!this.ready||!this.canvas||!this.ctx)return;const t=this.canvas.width/window.devicePixelRatio,s=this.canvas.height/window.devicePixelRatio;this.ctx.clearRect(0,0,t,s),this.ctx.fillStyle=M.bgColor,this.ctx.fillRect(0,0,t,s),this.ctx.save(),this.ctx.translate(this.offsetX,this.offsetY),this.ctx.scale(this.scale,this.scale);const n=this.engine.currentProfile;this.ctx.fillStyle="#000000",this.ctx.shadowColor="rgba(0,0,0,0.5)",this.ctx.shadowBlur=20,this.ctx.fillRect(0,0,n.width,n.height),this.ctx.shadowBlur=0,this.ctx.strokeStyle="#333",this.ctx.lineWidth=1/this.scale,this.ctx.strokeRect(0,0,n.width,n.height),this.ctx.lineWidth=M.strokeWidth,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.engine.layers.forEach(a=>{a.visible&&(this.ctx.beginPath(),this.ctx.strokeStyle=a.color,a.paths.forEach(l=>{if(!(l.length<2)){this.ctx.moveTo(l[0].x,l[0].y);for(let d=1;d<l.length;d++)this.ctx.lineTo(l[d].x,l[d].y)}}),this.ctx.stroke())}),this.ctx.restore()}wheel(t){if(!this.ready)return;t.preventDefault();const s=this.scale*(1+(t.deltaY>0?-.1:.1));this.scale=Math.max(.1,Math.min(s,20)),this.draw()}down(t){this.ready&&(t.shiftKey||t.button===1)&&(this.isDrag=!0,this.lastM={x:t.clientX,y:t.clientY},this.canvas.style.cursor="grabbing")}move(t){!this.ready||!this.isDrag||(this.offsetX+=t.clientX-this.lastM.x,this.offsetY+=t.clientY-this.lastM.y,this.lastM={x:t.clientX,y:t.clientY},this.draw())}up(){!this.ready||!this.canvas||(this.isDrag=!1,this.canvas.style.cursor="crosshair")}}const Y={flowfield:"Particles traverse a vector field generated by Simplex noise. Creates organic, fluid-like textures resembling hair or flowing water.",lissajous:"Parametric curves created by the intersection of two sinusoidal waves. Produces elegant, looping harmonic figures often used in signal physics.",wavetable:"Generates terrain-like elevations by modulating horizontal lines with noise. Inspired by the visualization of pulsar radio waves.",spiral:"An Archimedean spiral distorted by noise. Can create vinyl-like grooves or organic coil patterns.",grid:"A rectilinear mesh deformed by noise fields. Supports warping vertices or displacing rows/cols for glitch effects.",phylla:"Arranges points in a spiral pattern based on the golden angle (137.5°). Mimics seed heads in sunflowers and succulents.",boids:"Simulates the flocking behavior of birds (Agents). Rules for Separation, Alignment, and Cohesion create complex emergent movement trails.",attractor:"Plots Strange Attractors (Lorenz, Aizawa). These represent chaotic systems where trajectories orbit a fractal set of states.",hyphae:"Simulates organic growth (like fungi or roots) using a branching algorithm. Sources grow segments and fork based on probability.",circles:"A packing algorithm that fills space with non-overlapping circles of varying sizes. Creates bubbly, cellular structures.",cityscape:"Generates a procedural skyline with multiple depth layers. Features randomized building silhouettes, window grids, and roof details."},f=e=>{const t=document.getElementById(e);return t||console.warn(`[UI] Missing element #${e}`),t},N={flowfield:[{id:"noiseScale",label:"Noise Scale",type:"range",min:.001,max:.1,step:.001},{id:"density",label:"Density",type:"range",min:100,max:5e3,step:100},{id:"stepLen",label:"Step Length",type:"range",min:1,max:20,step:1},{id:"maxSteps",label:"Max Steps",type:"range",min:10,max:500,step:10},{id:"force",label:"Distortion Force",type:"range",min:.1,max:5,step:.1},{id:"chaos",label:"Chaos",type:"range",min:0,max:1,step:.1},{id:"octaves",label:"Octaves",type:"range",min:1,max:4,step:1}],lissajous:[{id:"freqX",label:"Freq X",type:"range",min:1,max:20,step:.1},{id:"freqY",label:"Freq Y",type:"range",min:1,max:20,step:.1},{id:"damping",label:"Damping",type:"range",min:0,max:.01,step:1e-4},{id:"phase",label:"Phase",type:"range",min:0,max:6.28,step:.1},{id:"rotation",label:"Rotation",type:"range",min:0,max:360,step:1},{id:"resolution",label:"Resolution",type:"range",min:10,max:200,step:10}],wavetable:[{id:"lines",label:"Lines",type:"range",min:5,max:100,step:1},{id:"amplitude",label:"Amplitude",type:"range",min:1,max:100,step:1},{id:"zoom",label:"Noise Zoom",type:"range",min:.001,max:.1,step:.001},{id:"tilt",label:"Tilt Y",type:"range",min:-10,max:10,step:1},{id:"gap",label:"Line Gap",type:"range",min:.1,max:3,step:.1},{id:"freq",label:"Frequency",type:"range",min:.1,max:5,step:.1}],spiral:[{id:"loops",label:"Loops",type:"range",min:1,max:50,step:1},{id:"res",label:"Resolution",type:"range",min:10,max:200,step:10},{id:"startR",label:"Inner Radius",type:"range",min:0,max:50,step:1},{id:"noiseAmp",label:"Noise Amp",type:"range",min:0,max:50,step:1},{id:"noiseFreq",label:"Noise Freq",type:"range",min:.01,max:1,step:.01}],grid:[{id:"rows",label:"Rows",type:"range",min:2,max:50,step:1},{id:"cols",label:"Cols",type:"range",min:2,max:50,step:1},{id:"distortion",label:"Distortion",type:"range",min:0,max:50,step:1},{id:"noiseScale",label:"Noise Scale",type:"range",min:.01,max:.2,step:.01},{id:"chaos",label:"Chaos",type:"range",min:0,max:10,step:.1}],phylla:[{id:"count",label:"Count",type:"range",min:100,max:2e3,step:100},{id:"spacing",label:"Spacing",type:"range",min:1,max:10,step:.1},{id:"angleStr",label:"Angle",type:"range",min:130,max:140,step:.01},{id:"divergence",label:"Divergence",type:"range",min:.5,max:2,step:.1},{id:"noiseInf",label:"Noise Infl.",type:"range",min:0,max:20,step:1}],boids:[{id:"count",label:"Agents",type:"range",min:10,max:300,step:10},{id:"steps",label:"Duration",type:"range",min:50,max:500,step:10},{id:"speed",label:"Speed",type:"range",min:.5,max:5,step:.1},{id:"sepDist",label:"Separation",type:"range",min:1,max:50,step:1},{id:"alignDist",label:"Alignment",type:"range",min:1,max:50,step:1},{id:"cohDist",label:"Cohesion",type:"range",min:1,max:50,step:1},{id:"force",label:"Steer Force",type:"range",min:.01,max:.2,step:.01}],attractor:[{id:"scale",label:"Scale",type:"range",min:1,max:20,step:.1},{id:"iter",label:"Iterations",type:"range",min:100,max:5e3,step:100},{id:"sigma",label:"Sigma",type:"range",min:1,max:50,step:.1},{id:"rho",label:"Rho",type:"range",min:1,max:100,step:.1},{id:"beta",label:"Beta",type:"range",min:.1,max:10,step:.1},{id:"dt",label:"Time Step",type:"range",min:.001,max:.05,step:.001}],hyphae:[{id:"sources",label:"Sources",type:"range",min:1,max:10,step:1},{id:"steps",label:"Growth Steps",type:"range",min:10,max:200,step:10},{id:"branchProb",label:"Branch Prob",type:"range",min:0,max:.2,step:.01},{id:"angleVar",label:"Wiggle",type:"range",min:0,max:2,step:.1},{id:"segLen",label:"Segment Len",type:"range",min:1,max:10,step:.1}],circles:[{id:"count",label:"Max Count",type:"range",min:10,max:1e3,step:10},{id:"minR",label:"Min Radius",type:"range",min:.5,max:10,step:.5},{id:"maxR",label:"Max Radius",type:"range",min:2,max:50,step:1},{id:"padding",label:"Padding",type:"range",min:0,max:10,step:.5},{id:"attempts",label:"Attempts",type:"range",min:50,max:5e3,step:50}],cityscape:[{id:"rows",label:"Rows",type:"range",min:1,max:5,step:1},{id:"minW",label:"Min Width",type:"range",min:5,max:50,step:1},{id:"maxW",label:"Max Width",type:"range",min:10,max:100,step:1},{id:"minH",label:"Min Height",type:"range",min:5,max:100,step:1},{id:"maxH",label:"Max Height",type:"range",min:10,max:150,step:1},{id:"windowProb",label:"Window Prob",type:"range",min:0,max:1,step:.05},{id:"detail",label:"Roof Detail",type:"range",min:0,max:1,step:.05}]};class z{constructor(t){this.app=t,this.controls=N,this.initModuleDropdown(),this.bindGlobal(),this.renderLayers(),this.buildControls(),this.updateFormula(),this.initSettingsValues()}initModuleDropdown(){const t=f("generator-module");t&&(t.innerHTML="",Object.keys(I).forEach(s=>{const n=document.createElement("option");n.value=s,n.innerText=s.charAt(0).toUpperCase()+s.slice(1),t.appendChild(n)}))}initSettingsValues(){const t=f("set-margin"),s=f("set-speed-down"),n=f("set-speed-up"),a=f("set-stroke"),l=f("set-precision"),d=f("inp-bg-color");t&&(t.value=M.margin),s&&(s.value=M.speedDown),n&&(n.value=M.speedUp),a&&(a.value=M.strokeWidth),l&&(l.value=M.precision),d&&(d.value=M.bgColor)}bindGlobal(){const t=f("btn-add-layer"),s=f("generator-module"),n=f("inp-bg-color"),a=f("settings-panel"),l=f("btn-settings"),d=f("btn-close-settings"),h=f("machine-profile"),y=f("set-margin"),p=f("set-speed-down"),o=f("set-speed-up"),i=f("set-stroke"),c=f("btn-export"),m=f("btn-reset-view");t&&s&&(t.onclick=()=>{const u=s.value;this.app.engine.addLayer(u),this.renderLayers(),this.app.render()}),s&&(s.onchange=u=>{const x=this.app.engine.getActiveLayer();if(x){x.type=u.target.value,x.params=JSON.parse(JSON.stringify(I[x.type]));const v=f("inp-seed"),b=f("inp-pos-x"),w=f("inp-pos-y"),S=f("inp-scale-x"),L=f("inp-scale-y");x.params.seed=parseInt(v==null?void 0:v.value,10)||Math.floor(Math.random()*999),x.params.posX=parseFloat(b==null?void 0:b.value)||0,x.params.posY=parseFloat(w==null?void 0:w.value)||0,x.params.scaleX=parseFloat(S==null?void 0:S.value)||1,x.params.scaleY=parseFloat(L==null?void 0:L.value)||1,this.buildControls(),this.app.regen()}}),n&&(n.oninput=u=>{M.bgColor=u.target.value,this.app.render()}),l&&a&&(l.onclick=()=>a.classList.toggle("open")),d&&a&&(d.onclick=()=>a.classList.remove("open")),h&&(h.onchange=u=>{this.app.engine.setProfile(u.target.value),this.app.renderer.center(),this.app.regen()}),y&&(y.onchange=u=>{M.margin=parseInt(u.target.value,10),this.app.regen()}),p&&(p.onchange=u=>{M.speedDown=parseInt(u.target.value,10),this.app.updateStats()}),o&&(o.onchange=u=>{M.speedUp=parseInt(u.target.value,10),this.app.updateStats()}),i&&(i.onchange=u=>{M.strokeWidth=parseFloat(u.target.value),this.app.render()}),c&&(c.onclick=()=>this.exportSVG()),m&&(m.onclick=()=>this.app.renderer.center());const r=(u,x)=>{const v=f(u);v&&(v.onchange=b=>{const w=this.app.engine.getActiveLayer();w&&(w.params[x]=parseFloat(b.target.value),this.app.regen())})};r("inp-seed","seed"),r("inp-pos-x","posX"),r("inp-pos-y","posY"),r("inp-scale-x","scaleX"),r("inp-scale-y","scaleY");const g=f("btn-rand-seed");g&&(g.onclick=()=>{const u=this.app.engine.getActiveLayer(),x=f("inp-seed");u&&(u.params.seed=Math.floor(Math.random()*99999),x&&(x.value=u.params.seed),this.app.regen(),this.updateFormula())})}renderLayers(){const t=f("layer-list");t&&(t.innerHTML="",this.app.engine.layers.slice().reverse().forEach(s=>{const n=document.createElement("div"),a=s.id===this.app.engine.activeLayerId;n.className=`flex items-center justify-between bg-vectura-bg border border-vectura-border p-2 mb-2 group cursor-pointer hover:bg-vectura-border ${a?"active":""}`,n.innerHTML=`
          <div class="flex items-center gap-2 flex-1 overflow-hidden">
            <input type="checkbox" ${s.visible?"checked":""} class="cursor-pointer" aria-label="Toggle layer visibility">
            <span class="text-xs truncate ${a?"text-white font-bold":"text-vectura-muted"}">${s.name}</span>
          </div>
          <div class="flex items-center gap-1">
            <button class="text-[10px] text-vectura-muted hover:text-white px-1 btn-up" aria-label="Move layer up">▲</button>
            <button class="text-[10px] text-vectura-muted hover:text-white px-1 btn-down" aria-label="Move layer down">▼</button>
            <div class="relative w-3 h-3 overflow-hidden rounded-full border border-vectura-border ml-1">
              <input type="color" value="${s.color}" class="color-picker" aria-label="Layer color">
            </div>
            <button class="text-xs text-vectura-muted hover:text-vectura-danger px-1 ml-1 btn-del" aria-label="Delete layer">✕</button>
          </div>
        `;const l=n.querySelector("span"),d=n.querySelector("input[type=checkbox]"),h=n.querySelector(".color-picker"),y=n.querySelector(".btn-del"),p=n.querySelector(".btn-up"),o=n.querySelector(".btn-down");l&&(l.onclick=()=>{this.app.engine.activeLayerId=s.id,this.renderLayers(),this.buildControls(),this.updateFormula()}),d&&(d.onchange=i=>{s.visible=i.target.checked,this.app.render(),this.app.updateStats()}),h&&(h.oninput=i=>{s.color=i.target.value,this.app.render()}),y&&(y.onclick=i=>{i.stopPropagation(),this.app.engine.removeLayer(s.id),this.renderLayers(),this.app.render()}),p&&(p.onclick=i=>{i.stopPropagation(),this.app.engine.moveLayer(s.id,1),this.renderLayers(),this.app.render()}),o&&(o.onclick=i=>{i.stopPropagation(),this.app.engine.moveLayer(s.id,-1),this.renderLayers(),this.app.render()}),t.appendChild(n)}))}buildControls(){const t=f("dynamic-controls");if(!t)return;t.innerHTML="";const s=this.app.engine.getActiveLayer();if(!s)return;const n=f("generator-module"),a=f("inp-seed"),l=f("inp-pos-x"),d=f("inp-pos-y"),h=f("inp-scale-x"),y=f("inp-scale-y");n&&(n.value=s.type),a&&(a.value=s.params.seed),l&&(l.value=s.params.posX),d&&(d.value=s.params.posY),h&&(h.value=s.params.scaleX),y&&(y.value=s.params.scaleY);const p=f("algo-desc");p&&(p.innerText=Y[s.type]||"No description available.");const o=this.controls[s.type];o&&o.forEach(i=>{const c=s.params[i.id],m=document.createElement("div");m.className="mb-4",m.innerHTML=`
        <div class="flex justify-between mb-1">
          <label class="control-label mb-0">${i.label}</label>
          <span class="text-xs text-vectura-accent font-mono">${c}</span>
        </div>
        <input type="range" min="${i.min}" max="${i.max}" step="${i.step}" value="${c}" class="w-full">
      `;const r=m.querySelector("input"),g=m.querySelector("span");r&&g&&(r.oninput=u=>g.innerText=u.target.value,r.onchange=u=>{s.params[i.id]=parseFloat(u.target.value),this.app.regen(),this.updateFormula()}),t.appendChild(m)})}updateFormula(){const t=this.app.engine.getActiveLayer();if(!t)return;const s=f("formula-display"),n=f("formula-seed-display");s&&(s.innerText=this.app.engine.getFormula(t.id)),n&&(n.innerText=`Seed: ${t.params.seed}`)}exportSVG(){const t=this.app.engine.currentProfile;let s=`<?xml version="1.0" standalone="no"?><svg width="${t.width}mm" height="${t.height}mm" viewBox="0 0 ${t.width} ${t.height}" xmlns="http://www.w3.org/2000/svg">`;this.app.engine.layers.forEach(l=>{l.visible&&(s+=`<g id="${l.name.replace(/\s/g,"_")}" stroke="black" stroke-width="0.3" fill="none">`,l.paths.forEach(d=>{d.length<2||(s+=`<path d="M ${d.map(h=>`${h.x.toFixed(3)} ${h.y.toFixed(3)}`).join(" L ")}" />`)}),s+="</g>")}),s+="</svg>";const n=URL.createObjectURL(new Blob([s],{type:"image/svg+xml"})),a=document.createElement("a");a.href=n,a.download="vectura.svg",a.click()}}class B{constructor(){console.log("Initializing Vectura Studio..."),this.engine=new W,this.renderer=new X("main-canvas",this.engine),this.ui=new z(this),this.render()}regen(){this.engine.generate(this.engine.activeLayerId),this.render(),this.ui.updateFormula()}render(){this.renderer.draw(),this.updateStats()}updateStats(){const t=this.engine.getStats(),s=document.getElementById("stat-dist"),n=document.getElementById("stat-time");!s||!n||(s.innerText=t.distance,n.innerText=t.time)}}window.addEventListener("load",()=>{window.app=new B});
